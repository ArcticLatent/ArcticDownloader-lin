<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arctic ComfyUI Helper</title>
    <link rel="icon" type="image/svg+xml" href="./icon.svg" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="startup-overlay" class="startup-overlay" aria-live="polite" aria-busy="true">
      <div class="startup-card">
        <img class="startup-icon" src="./icon.svg" alt="Arctic icon" />
        <h2>Arctic ComfyUI Helper</h2>
        <p id="startup-status" class="startup-status">Preparing workspace...</p>
        <div class="startup-spinner" aria-hidden="true"></div>
      </div>
    </div>

    <main class="app-shell">
      <header class="topbar">
        <div class="title-wrap">
          <img class="title-icon" src="./icon.svg" alt="Arctic icon" />
          <h1>Arctic ComfyUI Helper</h1>
          <p id="version" class="title-meta">Version</p>
        </div>
        <div class="top-actions">
          <span id="update-status">Idle</span>
          <div class="update-action-col">
            <span id="app-version-tag" class="app-version-tag">v0.1.0</span>
            <button id="check-updates">Check Updates</button>
          </div>
        </div>
      </header>

      <nav class="tabs">
        <button class="tab active" data-tab="comfyui" id="tab-comfyui">ComfyUI</button>
        <button class="tab" data-tab="models" id="tab-models">Models</button>
        <button class="tab" data-tab="loras" id="tab-loras">LoRAs</button>
        <button class="tab" data-tab="workflows" id="tab-workflows">Workflows</button>
      </nav>

      <section class="panel" id="tab-content-comfyui">
        <div class="row torch-row">
          <select id="comfy-torch-profile"></select>
          <span id="comfy-torch-recommended">Recommended: Detecting...</span>
        </div>
        <div class="row torch-row">
          <select id="comfy-mode">
            <option value="install">Install New</option>
            <option value="manage">Manage Existing</option>
          </select>
          <span id="comfy-mode-help">Choose install mode</span>
        </div>
        <div class="row existing-row">
          <select id="comfy-existing-install">
            <option value="">No detected installations</option>
          </select>
          <button id="update-selected-install">Check ComfyUI</button>
          <button id="use-existing-install">Use Selected</button>
        </div>

        <div class="row folder-row">
          <input id="comfy-install-root" type="text" placeholder="Select base folder (e.g. Documents). App will create /ComfyUI inside it." />
          <button id="choose-install-root">Choose Base</button>
          <button id="save-install-root">Save Base</button>
        </div>
        <div class="row folder-row" id="comfy-extra-model-row">
          <input id="comfy-extra-model-root" type="text" placeholder="Optional shared models root (for extra_model_paths.yaml)" />
          <button id="choose-extra-model-root">Choose Shared</button>
          <label title="When enabled, model downloads use this shared folder by default via extra_model_paths.yaml">
            <input type="checkbox" id="comfy-extra-model-default" />
            Use as Default
          </label>
          <button id="clear-extra-model-root">Clear Shared</button>
        </div>
        <div class="row resume-banner hidden" id="comfy-resume-banner">
          <span id="comfy-resume-text">Interrupted install found.</span>
          <button id="comfy-resume-btn">Resume Install</button>
          <button id="comfy-fresh-btn">Start Fresh</button>
        </div>

        <div class="row section-header">
          <h3>Add-Ons</h3>
        </div>
        <div class="row option-grid">
          <label title="SageAttention is a drop-in attention replacement used in ComfyUI (and PyTorch diffusion stacks) that makes attention faster and far more memory-efficient—without changing model outputs or forcing a whole new runtime."><input type="checkbox" id="addon-sageattention" /> SageAttention</label>
          <label title="Requires NVIDIA 50-series GPUs. SageAttention is a drop-in attention replacement used in ComfyUI (and PyTorch diffusion stacks) that makes attention faster and far more memory-efficient—without changing model outputs or forcing a whole new runtime."><input type="checkbox" id="addon-sageattention3" /> SageAttention3 (RTX 50 only)</label>
          <label title="FlashAttention is a GPU-optimized attention algorithm that makes transformer attention much faster and more memory-efficient by computing it in fused CUDA kernels instead of the usual step-by-step PyTorch ops"><input type="checkbox" id="addon-flashattention" /> FlashAttention</label>
          <label title="Insightface will be installed automatically with Nunchaku for PuLID (Face Consistency) features within the ComfyUI-nunchaku custom nodes. InsightFace is an open-source deep learning framework for face analysis, focused on high-performance face recognition, face detection, and related tasks"><input type="checkbox" id="addon-insightface" /> InsightFace</label>
          <label title="Nunchaku is a high-performance inference backend (and node set) that replaces parts of the standard PyTorch execution path to make large diffusion models run much faster and with less VRAM—especially on modern NVIDIA GPUs. Insightface will be installed automatically with Nunchaku for PuLID (Face Consistency) features within the ComfyUI-nunchaku custom nodes."><input type="checkbox" id="addon-nunchaku" /> Nunchaku</label>
          <label title="Requires Torch 2.8.0 + cu128. Recommended to use with FlashAttention. Trellis does not support SageAttention. TRELLIS-2 is a Microsoft research 3D foundation model that generates structured, textured 3D assets (meshes + geometry + textures)"><input type="checkbox" id="addon-trellis2" /> Trellis2</label>
          <label title="Pinned memory in ComfyUI should generally be kept ON for faster sampling speeds (10-50% improvement) by optimizing CPU-to-GPU data transfers, as it is now enabled by default. It is particularly beneficial for NVIDIA users to improve efficiency. However, if you experience crashes, OOM errors, or system instability disable it."><input type="checkbox" id="addon-pinned-memory" checked /> Pinned Memory</label>
        </div>

        <div class="row section-header">
          <h3>Custom-Nodes</h3>
        </div>
        <div class="row option-grid">
          <label><input type="checkbox" id="node-comfyui-manager" /> comfyui-manager</label>
          <label><input type="checkbox" id="node-comfyui-easy-use" /> ComfyUI-Easy-Use</label>
          <label><input type="checkbox" id="node-rgthree-comfy" /> rgthree-comfy</label>
          <label><input type="checkbox" id="node-comfyui-gguf" /> ComfyUI-GGUF</label>
          <label><input type="checkbox" id="node-comfyui-kjnodes" /> comfyui-kjnodes</label>
          <label><input type="checkbox" id="node-comfyui-crystools" /> comfyui-crystools</label>
        </div>

        <div class="row install-action-row">
          <button id="install-comfyui" class="primary">Install ComfyUI</button>
          <span id="comfy-install-spinner" class="install-spinner hidden" aria-hidden="true"></span>
        </div>
        <div class="row hidden" id="comfy-quick-actions">
          <div id="comfy-last-install-path" class="transfer-sub">Last install: -</div>
          <div class="row preflight-row">
            <button id="comfy-open-install-folder">Open Install Folder</button>
            <button id="comfy-start-installed">Start ComfyUI</button>
          </div>
        </div>

        <div class="row section-header">
          <h3>Preflight Checks</h3>
        </div>
        <div class="row preflight-row">
          <button id="run-preflight">Run Preflight</button>
          <span id="preflight-summary">Not run yet.</span>
        </div>
        <div class="row">
          <div id="preflight-list" class="preflight-list">
            <div class="empty-msg">No checks executed yet.</div>
          </div>
        </div>

        <div class="row">
          <h3>ComfyUI Install Logs</h3>
          <pre id="comfy-install-log" class="comfy-log">Ready</pre>
        </div>
        <div class="row">
          <button id="comfy-clear-install-log">Clear Logs</button>
        </div>
      </section>

      <section class="panel hidden" id="tab-content-models">
        <div class="row folder-row">
          <input id="comfy-root" type="text" placeholder="Select your ComfyUI root folder" />
          <button id="choose-root">Choose Folder</button>
          <button id="save-root">Save Folder</button>
        </div>

        <div class="row model-row">
          <select id="model-family"></select>
          <select id="model-id"></select>
          <select id="vram-tier"></select>
          <select id="ram-tier"></select>
          <select id="variant-id"></select>
        </div>

        <div class="row">
          <button id="download-model" class="primary">Download Model Assets</button>
        </div>
        <div class="row option-grid">
          <label title="Experimental. Enables Hugging Face Xet-backed download path for model files. May be faster on some networks/disks but can stall or behave inconsistently.">
            <input type="checkbox" id="enable-hf-xet" />
            Enable HF Xet (Experimental)
          </label>
          <span class="transfer-sub">Experimental: Xet can improve speed but may show unstable behavior. Default downloader is recommended.</span>
        </div>
      </section>

      <section class="panel hidden" id="tab-content-loras">
        <div class="row folder-row">
          <input id="comfy-root-lora" type="text" placeholder="Select your ComfyUI root folder" />
          <button id="choose-root-lora">Choose Folder</button>
          <button id="save-root-lora">Save Folder</button>
        </div>

        <div class="row lora-row">
          <select id="lora-family"></select>
          <select id="lora-id"></select>
          <button id="download-lora" class="primary">Download LoRA</button>
        </div>

        <div class="row token-row">
          <input id="civitai-token" type="password" placeholder="Civitai API token (optional)" />
          <button id="save-token">Save Token</button>
        </div>

        <div class="lora-meta">
          <div><strong>Owner:</strong> <a id="meta-creator-link" href="#" target="_blank" rel="noopener noreferrer"><span id="meta-creator">-</span></a></div>
          <div><strong>Strength:</strong> <span id="meta-strength">-</span></div>
          <div><strong>Triggers:</strong> <span id="meta-triggers">-</span></div>
          <div><strong>Description:</strong> <span id="meta-description">-</span></div>
        </div>

        <div class="preview" id="preview-container">
          <img id="preview-image" class="hidden" alt="LoRA preview" />
          <video id="preview-video" class="hidden" controls autoplay muted loop playsinline></video>
          <p id="preview-caption">No preview loaded.</p>
        </div>
      </section>

      <section class="panel hidden" id="tab-content-workflows">
        <div class="row folder-row">
          <input id="comfy-root-workflow" type="text" placeholder="Select your ComfyUI root folder" />
          <button id="choose-root-workflow">Choose Folder</button>
          <button id="save-root-workflow">Save Folder</button>
        </div>

        <div class="row lora-row">
          <select id="workflow-family"></select>
          <select id="workflow-id"></select>
          <button id="download-workflow" class="primary">Download Workflow</button>
        </div>

        <div class="preview" id="workflow-preview-container">
          <img id="workflow-preview-image" class="hidden" alt="Workflow preview" />
          <p id="workflow-preview-caption">No workflow preview loaded.</p>
        </div>
        <div class="lora-meta">
          <div>
            <strong>YouTube Tutorial:</strong>
            <a id="workflow-youtube-link" href="#" target="_blank" rel="noopener noreferrer">
              <span id="workflow-youtube-text">-</span>
            </a>
          </div>
        </div>
      </section>

      <section class="panel" id="downloads-status-panel">
        <h2>Status</h2>
        <div id="download-progress" class="progress-line">Idle</div>
        <div id="overall-progress" class="overall-progress hidden" aria-label="Overall download progress">
          <span id="overall-progress-fill"></span>
        </div>
        <div id="overall-progress-meta" class="transfer-sub hidden">Waiting for transfer data...</div>
        <div class="transfer-grid">
          <div>
            <h3>Active Transfers</h3>
            <div id="transfer-list" class="transfer-list"></div>
          </div>
          <div>
            <h3>Completed</h3>
            <div id="completed-list" class="transfer-list"></div>
          </div>
        </div>
        <div class="row">
          <h3>Download Logs</h3>
          <pre id="status-log" class="comfy-log">Ready</pre>
        </div>
        <div class="row">
          <button id="clear-status-log">Clear Logs</button>
        </div>
      </section>

      <footer class="footer-links">
        <button type="button" class="footer-link" data-url="https://github.com/ArcticLatent">
          <img src="./github.svg" alt="GitHub" />
          <span>GitHub</span>
        </button>
        <button type="button" class="footer-link" data-url="https://www.youtube.com/@ArcticLatent">
          <img src="./youtube.webp" alt="YouTube" />
          <span>YouTube</span>
        </button>
        <button type="button" class="footer-link" data-url="https://www.patreon.com/cw/ArcticLatent">
          <img src="./patreon.svg" alt="Patreon" />
          <span>Patreon</span>
        </button>
        <button type="button" class="footer-link" data-url="https://huggingface.co/arcticlatent">
          <img src="./huggingface.svg" alt="Hugging Face" />
          <span>Hugging Face</span>
        </button>
        <button type="button" class="footer-link" data-url="https://vimeo.com/1044521891">
          <img src="./vimeo.webp" alt="Vimeo" />
          <span>Vimeo</span>
        </button>
      </footer>
    </main>

    <div id="confirm-overlay" class="confirm-overlay hidden" aria-hidden="true">
      <div class="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
        <h3 id="confirm-title">Confirm Action</h3>
        <p id="confirm-message">Are you sure?</p>
        <div class="confirm-actions">
          <button id="confirm-yes" class="primary" type="button">Yes</button>
          <button id="confirm-no" type="button">No</button>
        </div>
      </div>
    </div>

    <script type="module" src="./main.js"></script>
  </body>
</html>
